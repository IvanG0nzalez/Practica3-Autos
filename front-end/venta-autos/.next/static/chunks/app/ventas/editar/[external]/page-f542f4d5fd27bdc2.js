(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[251],{9970:function(e,t,n){Promise.resolve().then(n.bind(n,778))},778:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var a=n(7437);n(5691);var r=n(2265),o=n(1865),s=n(4033),i=n(3369),l=n(5944),c=n(1396),d=n.n(c),u=n(6468),h=n(4174),m=n(8170);function f(e){var t;let{params:n}=e,c=n.external,f=(0,i.fK)(),x=(0,i.LP)(),j=(0,s.useRouter)(),p=(0,i.U2)("rol"),[b,v]=(0,r.useState)({}),[g,Z]=(0,r.useState)([]),[k,N]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{let e=(await (0,m.ZH)("/admin/ventas/obtener/e/"+f,x)).datos.find(e=>e.external_id===c);console.log("ventaEncontrada",e),e&&(v(e),S("numero",e.numero),S("recargo",e.recargo),S("total",e.total),N(e.auto||[]),S("total",e.auto.reduce((e,t)=>e+t.precio,0)));let t=await (0,m.ZH)("admin/autosDisponibles",x);console.log("autos",t),Z(t.datos)})()},[f,x,S,c]);let{register:w,handleSubmit:y,formState:C,setValue:S,watch:A}=(0,o.cI)({defaultValues:b}),{errors:_}=C,I=e=>{k.some(t=>t.external_id===e.external_id)||(N([...k,e]),S("auto",null),S("recargo",k.reduce((e,t)=>(t.recargo||0)+e,0)+(e.recargo||0)),S("total",parseFloat(A("total"))+(e.precio||0)+(e.recargo||0)))},O=e=>{let t=k[e],n=[...k];n.splice(e,1),N(n),S("recargo",n.reduce((e,t)=>(t.recargo||0)+e,0)),S("total",parseFloat(A("total"))-(t.precio||0)-(t.recargo||0))};return(0,a.jsxs)("div",{className:"row",children:["gerente"===p?(0,a.jsx)(u.Z,{}):(0,a.jsx)(h.Z,{}),(0,a.jsx)("h1",{children:"Modificar Venta"}),(0,a.jsx)("div",{className:"col-4 container-fluid",children:(0,a.jsxs)("form",{onSubmit:y(e=>{console.log("data",e);var t={autos:k.map(e=>e.external_id)};console.log("dato",t),(0,m.Lw)("admin/venta/editar/"+c,t,x).then(e=>{console.log("info",e),200===e.code?((0,l.Z)("Venta modificada correctamente","OK","sucess"),j.push("/ventas/propias")):(0,l.Z)("Error al modificar la venta!","Error","error")})}),children:[(0,a.jsxs)("div",{className:"form-outline form-white mb-4",children:[(0,a.jsx)("label",{className:"form-label",children:"N\xfamero"}),(0,a.jsx)("input",{...w("numero"),name:"numero",id:"numero",className:"form-control ".concat(_.numero?"is-invalid":""),readOnly:!0})]}),(0,a.jsxs)("div",{className:"form-outline form-white mb-4",children:[(0,a.jsx)("label",{className:"form-label",children:"Total"}),(0,a.jsx)("input",{...w("total"),name:"total",id:"total",className:"form-control ".concat(_.total?"is-invalid":""),readOnly:!0})]}),(0,a.jsxs)("div",{className:"form-outline form-white mb-4",children:[(0,a.jsx)("label",{children:"Autos Disponibles:"}),(0,a.jsxs)("select",{...w("auto"),className:"form-select ".concat(_.auto?"is-invalid":""),children:[(0,a.jsx)("option",{value:"",children:"Seleccionar Auto"}),g.map(e=>(0,a.jsxs)("option",{value:e.external_id,children:[e.marca," ",e.modelo," - ",e.color," (",e.anio,")"]},e.external_id))]}),(0,a.jsx)("div",{className:"alert alert-danger invalid-feedback",children:null===(t=_.auto)||void 0===t?void 0:t.message}),(0,a.jsx)("button",{type:"button",onClick:()=>I(g.find(e=>e.external_id===A("auto"))),className:"btn btn-outline-dark btn-sm d-block mx-auto mt-3 px-5",children:"Agregar Auto"})]}),(0,a.jsxs)("div",{className:"form-outline form-white mb-4",children:[(0,a.jsx)("label",{children:"Autos Seleccionados:"}),(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Marca"}),(0,a.jsx)("th",{children:"Modelo"}),(0,a.jsx)("th",{children:"A\xf1o"}),(0,a.jsx)("th",{children:"Color"}),(0,a.jsx)("th",{children:"Precio"}),(0,a.jsx)("th",{children:"Acciones"})]})}),(0,a.jsx)("tbody",{children:k.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.marca}),(0,a.jsx)("td",{children:e.modelo}),(0,a.jsx)("td",{children:e.anio}),(0,a.jsx)("td",{children:e.color}),(0,a.jsx)("td",{children:e.precio}),(0,a.jsx)("td",{children:(0,a.jsx)("button",{type:"button",onClick:()=>O(t),className:"btn btn-danger btn-sm d-block mx-auto",children:"Quitar"})})]},e.external_id))})]})]}),(0,a.jsxs)("div",{className:"d-flex gap-4",children:[(0,a.jsx)("button",{type:"submit",className:"btn btn-outline-dark btn-lg px-5",id:"boton-nuevo-auto",children:"Guardar"}),(0,a.jsx)(d(),{href:"/ventas/propias",children:(0,a.jsx)("button",{className:"btn btn-outline-dark btn-lg px-5",children:"Cancelar"})})]})]})})]})}},5944:function(e,t,n){"use strict";var a=n(5003),r=n.n(a);t.Z=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"success";return r()(t,e,n,{button:"ACEPTAR",closeOnEsc:!0,closeOnClickOutside:!0,timer:3e3})}},6468:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var a=n(7437),r=n(3369);n(1396);var o=n(5944),s=n(4033),i=n(2580),l=n(7380),c=n(8776);function d(){let e=(0,s.useRouter)(),t=async()=>{await (0,r.jH)(),(0,o.Z)("Adi\xf3s!","Hasta la pr\xf3xima"),e.push("/"),e.refresh()};return(0,a.jsx)(i.Z,{bg:"dark",expand:"lg",variant:"dark",children:(0,a.jsxs)("div",{className:"container-fluid",children:[(0,a.jsx)(i.Z.Toggle,{"aria-controls":"navbarSupportedContent"}),(0,a.jsx)(i.Z.Collapse,{id:"navbarSupportedContent",children:(0,a.jsxs)(l.Z,{className:"me-auto",children:[(0,a.jsx)(l.Z.Link,{onClick:t,children:"Cerrar Sesi\xf3n"}),(0,a.jsxs)(c.Z,{title:"Ventas",id:"basic-nav-dropdown",children:[(0,a.jsx)(c.Z.Item,{href:"/ventas",children:"Ventas"}),(0,a.jsx)(c.Z.Item,{href:"/ventas/propias",children:"Mis Ventas"})]}),(0,a.jsxs)(c.Z,{title:"Autos",id:"basic-nav-dropdown",children:[(0,a.jsx)(c.Z.Item,{href:"/autos",children:"Autos"}),(0,a.jsx)(c.Z.Item,{href:"/autos/vendidos",children:"Autos Vendidos"}),(0,a.jsx)(c.Z.Item,{href:"/autos/disponibles",children:"Autos Disponibles"})]}),(0,a.jsx)(l.Z.Link,{href:"/compradores",children:"Compradores"})]})})]})})}},4174:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var a=n(7437),r=n(3369);n(1396);var o=n(5944),s=n(4033),i=n(2580),l=n(7380),c=n(8776);function d(){let e=(0,s.useRouter)(),t=async()=>{await (0,r.jH)(),(0,o.Z)("Adi\xf3s!","Hasta la pr\xf3xima"),e.push("/"),e.refresh()};return(0,a.jsx)(i.Z,{bg:"dark",expand:"lg",variant:"dark",children:(0,a.jsxs)("div",{className:"container-fluid",children:[(0,a.jsx)(i.Z.Toggle,{"aria-controls":"navbarSupportedContent"}),(0,a.jsx)(i.Z.Collapse,{id:"navbarSupportedContent",children:(0,a.jsxs)(l.Z,{className:"me-auto",children:[(0,a.jsx)(l.Z.Link,{onClick:t,children:"Cerrar Sesi\xf3n"}),(0,a.jsxs)(c.Z,{title:"Ventas",id:"basic-nav-dropdown",children:[(0,a.jsx)(c.Z.Item,{href:"/ventas",children:"Ventas"}),(0,a.jsx)(c.Z.Item,{href:"/ventas/propias",children:"Mis Ventas"})]}),(0,a.jsx)(l.Z.Link,{href:"/compradores",children:"Compradores"})]})})]})})}},8170:function(e,t,n){"use strict";n.d(t,{Lw:function(){return c},MX:function(){return s},ZH:function(){return o},lf:function(){return i},m3:function(){return r},xC:function(){return l}});let a="http://localhost:3000/api/";async function r(e,t){let n=[];n={"Content-Type":"application/json"};let r=await fetch(a+e,{method:"POST",headers:n,body:JSON.stringify(t)});return await r.json()}async function o(e,t){let n=await fetch(a+e,{method:"GET",headers:{"Content-type":"application/json",token:t},cache:"no-store"});return await n.json()}async function s(e,t,n){let r=await fetch(a+e+n,{method:"GET",headers:{"Content-type":"application/json",token:t},cache:"no-store"});return await r.json()}async function i(e,t,n){let r=await fetch(a+e,{method:"POST",headers:{"Content-type":"application/json",token:n},body:JSON.stringify(t)});return await r.json()}async function l(e,t,n){let r=await fetch(a+e,{method:"POST",headers:{token:n},body:t});return await r.json()}async function c(e,t,n){let r=await fetch(a+e,{method:"PATCH",headers:{"Content-type":"application/json",token:n},body:JSON.stringify(t)});return await r.json()}},3369:function(e,t,n){"use strict";n.d(t,{Fr:function(){return o},LP:function(){return s},U2:function(){return r},a1:function(){return a},fK:function(){return i},jH:function(){return l},pR:function(){return c}});let a=(e,t)=>{sessionStorage.setItem(e,t)},r=e=>sessionStorage.getItem(e),o=e=>{sessionStorage.setItem("token",e)},s=()=>sessionStorage.getItem("token"),i=()=>sessionStorage.getItem("external_id"),l=()=>{sessionStorage.clear()},c=()=>{var e=sessionStorage.getItem("token");return e&&("undefined"!==e||null!==e||"null"!==e)}}},function(e){e.O(0,[595,664,729,971,938,744],function(){return e(e.s=9970)}),_N_E=e.O()}]);